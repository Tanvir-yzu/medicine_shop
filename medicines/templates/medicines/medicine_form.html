{% extends 'medicines/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<section class="max-w-4xl mx-auto px-4 py-10">
  <div class="bg-white rounded-2xl shadow-xl shadow-slate-200/60 p-6 md:p-8">

    <h2 class="text-3xl font-extrabold text-slate-800 mb-8">
      {{ title }}
    </h2>

    {% if scanned_data %}
      <div class="bg-indigo-50 border border-indigo-200
                  text-indigo-700 rounded-xl p-4 mb-8">
        <p class="font-semibold">New medicine detected</p>
        <p class="text-sm mt-1">
          The code <strong>{{ scanned_data }}</strong> wasnâ€™t found.
          Review the details and save when ready.
        </p>
      </div>
    {% endif %}

    <form method="post" class="space-y-10">
      {% csrf_token %}
      {{ form.non_field_errors }}

      <!-- ================= BASIC INFORMATION ================= -->
      <div>
        <div class="flex items-center mb-6">
          <div class="flex-grow border-t border-slate-300"></div>
          <span class="px-4 text-sm font-semibold text-slate-600 bg-white">
            Basic Information
          </span>
          <div class="flex-grow border-t border-slate-300"></div>
        </div>

        <!-- PARTITION GRID -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {% for field in form %}
            {% if field.name in "name generic_name manufacturer batch_number" %}
              <div>
                <label for="{{ field.id_for_label }}"
                       class="block text-sm font-semibold text-slate-700 mb-1.5">
                  {{ field.label }}
                  {% if field.field.required %}
                    <span class="text-rose-500">*</span>
                  {% endif %}
                </label>

                {{ field }}

                <script>
                  document.getElementById("{{ field.id_for_label }}")?.classList.add(
                    "w-full","px-3.5","py-2.5","rounded-lg",
                    "border","border-slate-300",
                    "bg-white","text-slate-900",
                    "placeholder:text-slate-400",
                    "focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500",
                    "transition"
                  );
                </script>

                {% if field.errors %}
                  <p class="text-rose-500 text-xs mt-1">{{ field.errors.0 }}</p>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- ================= STOCK & PRICING ================= -->
      <div>
        <div class="flex items-center mb-6">
          <div class="flex-grow border-t border-slate-300"></div>
          <span class="px-4 text-sm font-semibold text-slate-600 bg-white">
            Stock & Pricing
          </span>
          <div class="flex-grow border-t border-slate-300"></div>
        </div>

        <!-- PARTITION GRID -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          {% for field in form %}
            {% if field.name in "price stock expiry_date" %}
              <div>
                <label for="{{ field.id_for_label }}"
                       class="block text-sm font-semibold text-slate-700 mb-1.5">
                  {{ field.label }}
                  {% if field.field.required %}
                    <span class="text-rose-500">*</span>
                  {% endif %}
                </label>

                {{ field }}

                <script>
                  document.getElementById("{{ field.id_for_label }}")?.classList.add(
                    "w-full","px-3.5","py-2.5","rounded-lg",
                    "border","border-slate-300",
                    "bg-white","text-slate-900",
                    "focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500",
                    "transition"
                  );
                </script>

                {% if field.errors %}
                  <p class="text-rose-500 text-xs mt-1">{{ field.errors.0 }}</p>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- ================= DESCRIPTION ================= -->
      <div>
        <div class="flex items-center mb-6">
          <div class="flex-grow border-t border-slate-300"></div>
          <span class="px-4 text-sm font-semibold text-slate-600 bg-white">
            Additional Details
          </span>
          <div class="flex-grow border-t border-slate-300"></div>
        </div>

        <div class="grid grid-cols-1 gap-6">
          {% for field in form %}
            {% if field.name == "description" %}
              <div>
                <label for="{{ field.id_for_label }}"
                       class="block text-sm font-semibold text-slate-700 mb-1.5">
                  {{ field.label }}
                </label>

                {{ field }}

                <script>
                  document.getElementById("{{ field.id_for_label }}")?.classList.add(
                    "w-full","px-3.5","py-2.5","rounded-lg",
                    "border","border-slate-300",
                    "bg-white","text-slate-900",
                    "focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500",
                    "transition"
                  );
                </script>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- ================= ACTION BUTTONS ================= -->
      <div class="flex flex-col-reverse sm:flex-row sm:justify-end gap-3 pt-6">
        <a href="{% url 'medicine_list' %}"
           class="px-4 py-2.5 rounded-lg text-sm font-medium
                  border border-slate-300
                  text-slate-700 bg-white
                  hover:bg-slate-50 transition">
          Cancel
        </a>

        <button type="submit"
                class="px-5 py-2.5 rounded-lg text-sm font-semibold
                       text-white bg-indigo-600 hover:bg-indigo-500
                       focus:outline-none focus:ring-2 focus:ring-indigo-500
                       transition">
          Save Medicine
        </button>
      </div>

    </form>
  </div>
</section>
{% endblock %}
