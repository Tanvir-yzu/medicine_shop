{% extends 'medicines/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
  <!-- Header Card -->
  <div class="bg-gradient-to-r from-primary to-primary-dark rounded-2xl p-8 shadow-xl mb-6">
    <div class="flex items-center gap-4">
      <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4">
        <i class="fas fa-pills text-4xl text-white"></i>
      </div>
      <div>
        <h2 class="text-3xl font-bold text-white">{{ title }}</h2>
        <p class="text-cyan-100 mt-1">Fill in the medicine details below</p>
      </div>
    </div>
  </div>

  <!-- Scanned Data Alert -->
  {% if scanned_data %}
    <div class="bg-gradient-to-r from-indigo-50 to-blue-50 border-l-4 border-indigo-500 rounded-xl p-5 mb-6 shadow-md">
      <div class="flex items-start">
        <div class="bg-indigo-100 rounded-full p-2 mr-4">
          <i class="fas fa-qrcode text-indigo-600 text-xl"></i>
        </div>
        <div class="flex-1">
          <p class="font-semibold text-indigo-800">New medicine detected from QR scan</p>
          <p class="text-indigo-700 text-sm mt-1">
            The code <strong class="bg-indigo-200 px-2 py-0.5 rounded">{{ scanned_data }}</strong> wasn't found in inventory.
            Review the pre-filled details and save when ready.
          </p>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Form Card -->
  <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
    <form method="post" class="space-y-0">
      {% csrf_token %}
      {{ form.non_field_errors }}

      <!-- Section 1: Basic Information -->
      <div class="p-8 border-b border-gray-100">
        <div class="flex items-center mb-6">
          <div class="bg-primary/10 rounded-lg p-2.5 mr-3">
            <i class="fas fa-info-circle text-primary text-xl"></i>
          </div>
          <h3 class="text-xl font-bold text-gray-800">Basic Information</h3>
          <div class="flex-grow ml-6 h-px bg-gradient-to-r from-gray-200 to-transparent"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {% for field in form %}
            {% if field.name in "name generic_name manufacturer batch_number" %}
              <div class="group">
                <label for="{{ field.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2 group-hover:text-primary transition-colors">
                  {{ field.label }}
                  {% if field.field.required %}
                    <span class="text-red-500 ml-1">*</span>
                  {% endif %}
                </label>

                <div class="relative">
                  {% if field.name == "name" %}
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <i class="fas fa-prescription-bottle-alt text-gray-400"></i>
                    </div>
                  {% elif field.name == "generic_name" %}
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <i class="fas fa-flask text-gray-400"></i>
                    </div>
                  {% elif field.name == "manufacturer" %}
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <i class="fas fa-industry text-gray-400"></i>
                    </div>
                  {% elif field.name == "batch_number" %}
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <i class="fas fa-barcode text-gray-400"></i>
                    </div>
                  {% endif %}

                  {{ field }}

                  <script>
                    document.getElementById("{{ field.id_for_label }}")?.classList.add(
                      "w-full", "pl-10", "pr-4", "py-3", "rounded-xl",
                      "border-2", "border-gray-200",
                      "bg-gray-50", "text-gray-900",
                      "placeholder:text-gray-400",
                      "focus:ring-2", "focus:ring-primary/20", "focus:border-primary",
                      "transition", "duration-200", "hover:border-gray-300"
                    );
                  </script>
                </div>

                {% if field.errors %}
                  <p class="text-red-500 text-sm mt-1.5 flex items-center">
                    <i class="fas fa-exclamation-circle mr-1.5"></i>{{ field.errors.0 }}
                  </p>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Section 2: Stock & Pricing -->
      <div class="p-8 border-b border-gray-100 bg-gradient-to-br from-gray-50/50 to-white">
        <div class="flex items-center mb-6">
          <div class="bg-green-100 rounded-lg p-2.5 mr-3">
            <i class="fas fa-chart-line text-green-600 text-xl"></i>
          </div>
          <h3 class="text-xl font-bold text-gray-800">Stock & Pricing</h3>
          <div class="flex-grow ml-6 h-px bg-gradient-to-r from-gray-200 to-transparent"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          {% for field in form %}
            {% if field.name in "price stock expiry_date" %}
              <div class="group">
                <label for="{{ field.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2 group-hover:text-primary transition-colors">
                  {{ field.label }}
                  {% if field.field.required %}
                    <span class="text-red-500 ml-1">*</span>
                  {% endif %}
                </label>

                <div class="relative">
                  {% if field.name == "price" %}
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <i class="fas fa-tag text-gray-400"></i>
                    </div>
                  {% elif field.name == "stock" %}
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <i class="fas fa-boxes text-gray-400"></i>
                    </div>
                  {% elif field.name == "expiry_date" %}
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <i class="fas fa-calendar-alt text-gray-400"></i>
                    </div>
                  {% endif %}

                  {{ field }}

                  <script>
                    document.getElementById("{{ field.id_for_label }}")?.classList.add(
                      "w-full", "pl-10", "pr-4", "py-3", "rounded-xl",
                      "border-2", "border-gray-200",
                      "bg-gray-50", "text-gray-900",
                      "focus:ring-2", "focus:ring-primary/20", "focus:border-primary",
                      "transition", "duration-200", "hover:border-gray-300"
                    );
                  </script>
                </div>

                {% if field.errors %}
                  <p class="text-red-500 text-sm mt-1.5 flex items-center">
                    <i class="fas fa-exclamation-circle mr-1.5"></i>{{ field.errors.0 }}
                  </p>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Section 3: Additional Details -->
      <div class="p-8 bg-gradient-to-br from-blue-50/30 to-white">
        <div class="flex items-center mb-6">
          <div class="bg-blue-100 rounded-lg p-2.5 mr-3">
            <i class="fas fa-clipboard-list text-blue-600 text-xl"></i>
          </div>
          <h3 class="text-xl font-bold text-gray-800">Additional Details</h3>
          <div class="flex-grow ml-6 h-px bg-gradient-to-r from-gray-200 to-transparent"></div>
        </div>

        <div class="grid grid-cols-1 gap-6">
          {% for field in form %}
            {% if field.name == "description" %}
              <div class="group">
                <label for="{{ field.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2 group-hover:text-primary transition-colors">
                  {{ field.label }}
                </label>

                <div class="relative">
                  {{ field }}

                  <script>
                    document.getElementById("{{ field.id_for_label }}")?.classList.add(
                      "w-full", "px-4", "py-3", "rounded-xl",
                      "border-2", "border-gray-200",
                      "bg-gray-50", "text-gray-900",
                      "placeholder:text-gray-400",
                      "focus:ring-2", "focus:ring-primary/20", "focus:border-primary",
                      "transition", "duration-200", "min-h-[120px]", "resize-y"
                    );
                  </script>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="p-8 bg-gradient-to-r from-gray-50 to-white border-t border-gray-100">
        <div class="flex flex-col-reverse sm:flex-row sm:justify-end gap-4">
          <a href="{% url 'medicine_list' %}"
             class="inline-flex items-center justify-center px-6 py-3 rounded-xl text-sm font-semibold
                    border-2 border-gray-300
                    text-gray-700 bg-white
                    hover:bg-gray-50 hover:border-gray-400
                    transition-all duration-200 shadow-sm hover:shadow-md">
            <i class="fas fa-times mr-2"></i>
            Cancel
          </a>

          <button type="submit"
                  class="inline-flex items-center justify-center px-8 py-3 rounded-xl text-sm font-semibold
                         text-white bg-gradient-to-r from-primary to-primary-dark
                         hover:from-primary-dark hover:to-primary
                         focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2
                         transition-all duration-200 shadow-lg hover:shadow-xl hover:-translate-y-0.5">
            <i class="fas fa-save mr-2"></i>
            Save Medicine
          </button>
        </div>
      </div>

    </form>
  </div>
</div>
{% endblock %}
